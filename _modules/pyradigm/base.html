

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyradigm.base &mdash; pyradigm 0.6+58.g1c5fab3.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyradigm
          

          
          </a>

          
            
            
              <div class="version">
                0.6+58.g1c5fab3.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Features and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../multi_dataset.html">MultiDataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API_classify.html">API for Classification dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API_regress.html">API for Regression dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API_multi_dataset.html">API for MultiDataset containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage_cli.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citation.html">Citation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyradigm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pyradigm.base</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyradigm.base</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Base module to define the ABCs for all MLDatasets</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="k">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">islice</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">PyradigmException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom exception to highlight pyradigm-specific issues.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">EmptyFeatureSetException</span><span class="p">(</span><span class="n">PyradigmException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom exception to catch empty feature set&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">ConstantValuesException</span><span class="p">(</span><span class="n">PyradigmException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom exception to indicate the exception of catching all constant values</span>
<span class="sd">    for a given samplet, for a specific feature across the samplets&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">InfiniteOrNaNValuesException</span><span class="p">(</span><span class="n">PyradigmException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom exception to catch NaN or Inf values.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">CompatibilityException</span><span class="p">(</span><span class="n">PyradigmException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception to indicate two datasets are not compatible in some way</span>
<span class="sd">        i.e. differing set of samplet IDs, or their target values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">is_iterable_but_not_str</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Boolean check for iterables that are not strings&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>


<span class="n">missing_value_indicator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

<span class="k">class</span> <span class="nc">BaseDataset</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract Base class for Dataset.</span>

<span class="sd">    samplet is a term reserved to referred to a single row in feature matrix X: N x p</span>

<span class="sd">    self.__class__() refers to the inherited child class instance at runtime!</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">target_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                 <span class="n">allow_nan_inf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">encode_nonnumeric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Init for the ABC to define the type and properties of the Dataset</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        target_type : type, callable</span>
<span class="sd">            Data type of the target for the child class.</span>
<span class="sd">            Must be callable that takes in a datatype and converts to its own type.</span>

<span class="sd">        dtype : np.dtype</span>
<span class="sd">            Data type of the features to be stored</span>

<span class="sd">        allow_nan_inf : bool or str</span>
<span class="sd">            Flag to indicate whether raise an error if NaN or Infinity values are</span>
<span class="sd">            found. If False, adding samplets with NaN or Inf features raises an error</span>
<span class="sd">            If True, neither NaN nor Inf raises an error. You can pass &#39;NaN&#39; or</span>
<span class="sd">            &#39;Inf&#39; to specify which value to allow depending on your needs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">target_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;target type must be callable, to allow for conversion!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span> <span class="o">=</span> <span class="n">target_type</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;data type for features </span><span class="si">{}</span><span class="s1"> not recognized!&#39;</span>
                            <span class="s1">&#39;It must be a subdtype of np.generic&#39;</span>
                            <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">allow_nan_inf</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;allow_nan_inf flag can only be bool or str&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allow_nan_inf</span> <span class="o">=</span> <span class="n">allow_nan_inf</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">encode_nonnumeric</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;encode_nonnumeric flag can only be bool&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_encode_nonnumeric</span> <span class="o">=</span> <span class="n">encode_nonnumeric</span>

        <span class="c1"># samplet-wise attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># dataset-wise attributes, common to all samplets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;data in its original dict form.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="k">def</span> <span class="nf">data_and_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dataset features and targets in a matrix form for learning.</span>

<span class="sd">        Also returns samplet_ids in the same order.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_matrix : ndarray</span>
<span class="sd">            2D array of shape [num_samplets, num_features]</span>
<span class="sd">            with features corresponding row-wise to samplet_ids</span>
<span class="sd">        targets : ndarray</span>
<span class="sd">            Array of numeric targets for each samplet corresponding row-wise to samplet_ids</span>
<span class="sd">        samplet_ids : list</span>
<span class="sd">            List of samplet ids</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sample_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="c1"># dtype=object allows for variable length strings!</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">samplet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">):</span>
            <span class="n">matrix</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">samplet</span><span class="p">]</span>
            <span class="n">targets</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">samplet</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">),</span> <span class="n">sample_ids</span>


    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates this dataset with the provided data.</span>
<span class="sd">        Usage of this method is discourage (unless you know what you are doing).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : dict</span>
<span class="sd">            dict of features keyed in by samplet ids.</span>

<span class="sd">        feature_names : list of str</span>
<span class="sd">            New feature names for the new features, if available.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If number of samplets does not match the size of existing set, or</span>
<span class="sd">            If atleast one samplet is not provided.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;number of samplets do not match the previously assigned targets&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;There must be at least 1 samplet in the dataset!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">values</span>
                <span class="c1"># update dimensionality</span>
                <span class="c1"># assuming all samplet_ids in dict have same len arrays</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">feature_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;data input must be a dictionary!&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the array of targets for all the samplets.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span>


    <span class="nd">@targets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Class targets (such as 1, 2, -1, &#39;A&#39;, &#39;B&#39; etc.) for each samplet in the dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;number of samplets do not match the previously assigned data&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;samplet ids do not match the previously assigned ids.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;targets input must be a dictionary!&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the feature names as an numpy array of strings.&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span>


    <span class="nd">@feature_names</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="s2">&quot;Stores the text targets for features&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of names do not match the number of features!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input is not a sequence. &quot;</span>
                             <span class="s2">&quot;Ensure names are in the same order &quot;</span>
                             <span class="s2">&quot;and length as features.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__take</span><span class="p">(</span><span class="n">nitems</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return first n items of the iterable as a list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nitems</span><span class="p">)))</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_str_names</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;f</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)])</span>


    <span class="k">def</span> <span class="nf">glance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nitems</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Quick and partial glance of the data matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nitems : int</span>
<span class="sd">            Number of items to glance from the dataset.</span>
<span class="sd">            Default : 5</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nitems</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">([</span><span class="n">nitems</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__take</span><span class="p">(</span><span class="n">nitems</span><span class="p">,</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>


    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to summarize the sample inside in an appropriate way!&quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">_check_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to ensure features to be added are not empty and vectorized.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : iterable</span>
<span class="sd">            Any data that can be converted to a numpy array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        features : numpy array</span>
<span class="sd">            Flattened non-empty numpy array.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If input data is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input features (of dtype </span><span class="si">{}</span><span class="s2">) can not be converted to &quot;</span>
                            <span class="s2">&quot;Dataset&#39;s data type </span><span class="si">{}</span><span class="s2">&quot;</span>
                            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EmptyFeatureSetException</span><span class="p">(</span><span class="s1">&#39;Provided features are empty.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_nan_inf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">InfiniteOrNaNValuesException</span><span class="p">(</span><span class="s1">&#39;NaN or Inf values found!&#39;</span>
                                 <span class="s1">&#39; They are not allowed and disabled by default.&#39;</span>
                                 <span class="s1">&#39; Use allow_nan_inf=True if you need to use them.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">features</span>


    <span class="k">def</span> <span class="nf">_check_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to ensure target to be added is not empty and vectorized.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target_value</span>
<span class="sd">            Value of the target</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        target_value</span>
<span class="sd">            Target value in the right data type</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If input target is not of the right data type for this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid type of target </span><span class="si">{}</span><span class="s1"> :&#39;</span>
                                <span class="s1">&#39; must be of type </span><span class="si">{}</span><span class="s1">, or be convertible to it&#39;</span>
                                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">target_value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">target_value</span>


    <span class="k">def</span> <span class="nf">_check_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplet_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to validate the samplet ID</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">samplet_id</span>


    <span class="k">def</span> <span class="nf">add_samplet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">samplet_id</span><span class="p">,</span>
                    <span class="n">features</span><span class="p">,</span>
                    <span class="n">target</span><span class="p">,</span>
                    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">attr_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">attr_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a new samplet to the dataset with its features, label and class ID.</span>

<span class="sd">        This is the preferred way to construct the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        samplet_id : str</span>
<span class="sd">            An identifier uniquely identifies this samplet.</span>
<span class="sd">        features : list, ndarray</span>
<span class="sd">            The features for this samplet</span>
<span class="sd">        target : int, str</span>
<span class="sd">            The label for this samplet</span>
<span class="sd">        overwrite : bool</span>
<span class="sd">            If True, allows the overwite of features for an existing subject ID.</span>
<span class="sd">            Default : False.</span>
<span class="sd">        feature_names : list</span>
<span class="sd">            The names for each feature. Assumed to be in the same order as `features`</span>

<span class="sd">        attr_names : str or list of str</span>
<span class="sd">            Name of the attribute to be added for this samplet</span>

<span class="sd">        attr_values : generic or list of generic</span>
<span class="sd">            Value of the attribute. Any data type allowed as long as they are</span>
<span class="sd">            compatible across all the samplets in this dataset.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `samplet_id` is already in the Dataset (and overwrite=False), or</span>
<span class="sd">            If dimensionality of the current samplet does not match the current, or</span>
<span class="sd">            If `feature_names` do not match existing names</span>
<span class="sd">        TypeError</span>
<span class="sd">            If samplet to be added is of different data type compared to existing</span>
<span class="sd">            samplets.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">samplet_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_id</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">samplet_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> already exists in this dataset!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">))</span>

        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_features</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">samplet_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">[</span><span class="n">samplet_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">size</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span>
                                                             <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">features</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">!=</span> <span class="n">features</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dimensionality of this samplet (</span><span class="si">{}</span><span class="s1">) &#39;</span>
                                 <span class="s1">&#39;does not match existing samplets (</span><span class="si">{}</span><span class="s1">)&#39;</span>
                                 <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">samplet_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">[</span><span class="n">samplet_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
            <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># if it was never set, allow it</span>
                <span class="c1"># class gets here when adding the first samplet,</span>
                <span class="c1">#   after dataset was initialized with empty constructor</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if set already, ensure a match</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;supplied feature names do not match the existing names!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">attr_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">attr_names</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr_values</span><span class="p">)</span> <span class="ow">or</span> \
                        <span class="p">(</span><span class="ow">not</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">attr_values</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When you supply a list for attr_names, &#39;</span>
                                     <span class="s1">&#39;attr_values also must be a list of same &#39;</span>
                                     <span class="s1">&#39;length&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">attr_values</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">samplet_id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">samplet_id</span><span class="p">,</span> <span class="n">attr_values</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">del_samplet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to remove a samplet from the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample_id : str</span>
<span class="sd">            samplet id to be removed.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        UserWarning</span>
<span class="sd">            If samplet id to delete was not found in the dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sample_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Sample to delete not found in the dataset - nothing to do.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sample_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sample_id</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> removed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_id</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">add_dataset_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds dataset-wide attributes (common to all samplets).</span>

<span class="sd">        This is a great way to add meta data (such as version, processing details,</span>
<span class="sd">        anything else common to all samplets). This is better than encoding the info</span>
<span class="sd">        into the description field, as this allow programmatic retrieval.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attr_name : str</span>
<span class="sd">            Identifier for the attribute</span>

<span class="sd">        attr_value : object</span>
<span class="sd">            Value of the attribute (any datatype)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>


    <span class="k">def</span> <span class="nf">add_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">samplet_id</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to add samplet-wise attributes to the dataset.</span>

<span class="sd">        Note: attribute values get overwritten by default, if they already exist</span>
<span class="sd">        for a given samplet</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attr_name : str</span>
<span class="sd">            Name of the attribute to be added.</span>

<span class="sd">        samplet_id : str or list of str</span>
<span class="sd">            Identifier(s) for the samplet</span>

<span class="sd">        attr_value : generic or list of generic</span>
<span class="sd">            Value(s) of the attribute. Any data type allowed, although it is</span>
<span class="sd">            strongly recommended to keep the data type the same, or compatible,</span>
<span class="sd">            across all the samplets in this dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="p">(</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;When samplet_id is a list, attr_value must &#39;</span>
                                    <span class="s1">&#39;also be a list&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr_value</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Number of attribute values provided do not &#39;</span>
                                     <span class="s1">&#39;match the number of samplet IDs&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samplet_id</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__add_single_attr</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">attr_value</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;When samplet_id is not a list, attr_value also &#39;</span>
                                    <span class="s1">&#39;must not be a list&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__add_single_attr</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">samplet_id</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attribute name can not be None!&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__add_single_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">samplet_id</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Actual attr adder.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">samplet_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Samplet </span><span class="si">{}</span><span class="s1"> does not exist in this Dataset.&#39;</span>
                           <span class="s1">&#39;Add it first via .add_samplet() method.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">attr_value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Datatype of attribute </span><span class="si">{}</span><span class="s1"> is expected to be </span><span class="si">{}</span><span class="s1">. &#39;</span>
                                <span class="s1">&#39;Value provided is of type: </span><span class="si">{}</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr_name</span><span class="p">],</span>
                                          <span class="nb">type</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">][</span><span class="n">samplet_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns attributes dictionary, keyed-in by [attr_name][samplet_id]&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span>


    <span class="nd">@attr</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Batch setter of attributes via dict of dicts&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">this_attr</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">this_attr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Value of attr </span><span class="si">{}</span><span class="s1"> must be a dict keyed in by &#39;</span>
                                    <span class="s1">&#39;samplet ids.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_attr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">{}</span><span class="s1"> is empty.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">existing_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                            <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">this_attr</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_ids</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;None of the samplets set for attr </span><span class="si">{}</span><span class="s1">&#39;</span>
                                         <span class="s1">&#39; exist in dataset!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_subset_from_dict</span><span class="p">(</span>
                            <span class="n">this_attr</span><span class="p">,</span> <span class="n">existing_ids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;attrs input must be a non-empty dict of dicts! &#39;</span>
                             <span class="s1">&#39;Top level key must be names of attributes. &#39;</span>
                             <span class="s1">&#39;Inner dicts must be keyed in by samplet ids.&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attr_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Direct access to attr dtype&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span>


    <span class="nd">@attr_dtype</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">attr_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Direct access to attr dtype&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attr dtype must be a dict&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Differing set of attributes.&#39;</span>
                             <span class="s1">&#39; Current: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span> <span class="o">=</span> <span class="n">values</span>


    <span class="k">def</span> <span class="nf">get_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">samplet_ids</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to retrieve specified attribute for a list of samplet IDs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attr_name : str</span>
<span class="sd">            Name of the attribute</span>

<span class="sd">        samplet_ids : str or list</span>
<span class="sd">            One or more samplet IDs whose attribute is being queried.</span>
<span class="sd">            Default: &#39;all&#39;, all the existing samplet IDs will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attr_values : ndarray</span>
<span class="sd">            Attribute values for the list of samplet IDs</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If attr_name was never set for dataset, or any of the samplets requested</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">{}</span><span class="s1"> is not set for this dataset&#39;</span>
                           <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">samplet_ids</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">samplet_ids</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">samplet_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">samplet_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">samplet_ids</span><span class="p">,</span> <span class="p">]</span>

        <span class="n">samplet_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">samplet_ids</span><span class="p">)</span>

        <span class="n">sid_not_exist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                                  <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">samplet_ids</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sid_not_exist</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Attr </span><span class="si">{}</span><span class="s1"> for </span><span class="si">{}</span><span class="s1"> samplets was not set:</span><span class="se">\n\t</span><span class="si">{}</span><span class="s1">&#39;</span>
                           <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">sid_not_exist</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                                     <span class="n">samplet_ids</span><span class="p">[</span><span class="n">sid_not_exist</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">][</span><span class="n">sid</span><span class="p">]</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">samplet_ids</span><span class="p">],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr_name</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">del_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">samplet_ids</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to retrieve specified attribute for a list of samplet IDs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attr_name : str</span>
<span class="sd">            Name of the attribute</span>

<span class="sd">        samplet_ids : str or list</span>
<span class="sd">            One or more samplet IDs whose attribute is being queried.</span>
<span class="sd">            Default: &#39;all&#39;, all the existing samplet IDs will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        Warning</span>
<span class="sd">            If attr_name was never set for this dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">{}</span><span class="s1"> is not set for this dataset&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">),</span>
                 <span class="ne">UserWarning</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable_but_not_str</span><span class="p">(</span><span class="n">samplet_ids</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">samplet_ids</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">samplet_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">samplet_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">samplet_ids</span><span class="p">,</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">samplet_ids</span><span class="p">:</span>
            <span class="c1"># None helps avoid error if sid does not exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">attr_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Simple summary of attributes currently stored in the dataset&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr_repr</span><span class="p">())</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataset_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns dataset attributes&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span>

    <span class="nd">@dataset_attr</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dataset_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Batch setter of dataset-wide attributes.</span>
<span class="sd">        Existing attrs/values will be replaced.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># the following code will not affect attrs that already exist in the</span>
            <span class="c1"># current but not in the new dict</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dataset_attr input must be a non-empty dict!&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_feature_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the subset of features indexed numerically.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset_idx : list, ndarray</span>
<span class="sd">            List of indices to features to be returned</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset : Dataset</span>
<span class="sd">            with subset of features requested.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        UnboundLocalError</span>
<span class="sd">            If input indices are out of bounds for the dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">subset_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">subset_idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">subset_idx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">subset_idx</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">UnboundLocalError</span><span class="p">(</span><span class="s1">&#39;indices out of range for the dataset. &#39;</span>
                                    <span class="s1">&#39;Max index: </span><span class="si">{}</span><span class="s1"> Min index : 0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">))</span>

        <span class="n">sub_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">samplet</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="n">subset_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">samplet</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">new_descr</span> <span class="o">=</span> <span class="s1">&#39;Subset features derived from: </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>
        <span class="n">subdataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sub_data</span><span class="p">,</span>
                                    <span class="n">targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">,</span>
                                    <span class="n">description</span><span class="o">=</span><span class="n">new_descr</span><span class="p">,</span>
                                    <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">[</span><span class="n">subset_idx</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">subdataset</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_keys_with_value</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s2">&quot;Returns a subset of keys from the dict with the value supplied.&quot;</span>

        <span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dictionary</span> <span class="k">if</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">subset</span>



    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">func_description</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a given a function to the features of each subject</span>
<span class="sd">            and returns a new dataset with other info unchanged.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            A callable that takes in a single ndarray and returns a single ndarray.</span>
<span class="sd">            Ensure the transformed dimensionality must be the same for all subjects.</span>

<span class="sd">            If your function requires more than one argument,</span>
<span class="sd">            use `functools.partial` to freeze all the arguments</span>
<span class="sd">            except the features for the subject.</span>

<span class="sd">        func_description : str, optional</span>
<span class="sd">            Human readable description of the given function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xfm_ds : Dataset</span>
<span class="sd">            with features obtained from subject-wise transform</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If given func is not a callable</span>
<span class="sd">        ValueError</span>
<span class="sd">            If transformation of any of the subjects features raises an exception.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        A simple example below shows the application of the `.apply_xfm()` to</span>
<span class="sd">        create a new pyradigm dataset:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from pyradigm import ClassificationDataset as ClfDataset</span>

<span class="sd">            thickness = ClfDataset(in_path=&#39;ADNI_thickness.csv&#39;)</span>
<span class="sd">            # get_pcg_median is a function that computes the median value in PCG</span>
<span class="sd">            pcg_thickness = thickness.apply_xfm(func=get_pcg_median,</span>
<span class="sd">                                        description = &#39;applying ROI mask for PCG&#39;)</span>
<span class="sd">            pcg_median = pcg_thickness.apply_xfm(func=np.median,</span>
<span class="sd">                                        description=&#39;median per subject&#39;)</span>


<span class="sd">        A complex example using a function that takes more than one argument:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from functools import partial</span>
<span class="sd">            import hiwenet</span>

<span class="sd">            thickness = ClfDataset(in_path=&#39;ADNI_thickness.csv&#39;)</span>
<span class="sd">            roi_membership = read_roi_membership()</span>
<span class="sd">            calc_hist_dist = partial(hiwenet, groups = roi_membership)</span>

<span class="sd">            thickness_hiwenet = thickness.transform(func=calc_hist_dist,</span>
<span class="sd">                                        description = &#39;histogram weighted networks&#39;)</span>
<span class="sd">            median_thk_hiwenet = thickness_hiwenet.transform(func=np.median,</span>
<span class="sd">                                        description=&#39;median per subject&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Given function </span><span class="si">{}</span><span class="s1"> is not a callable&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>

        <span class="n">xfm_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">samplet</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xfm_data</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to transform features for </span><span class="si">{}</span><span class="s1">. &#39;</span>
                      <span class="s1">&#39;Quitting.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">samplet</span><span class="p">))</span>
                <span class="k">raise</span>

            <span class="n">xfm_ds</span><span class="o">.</span><span class="n">add_samplet</span><span class="p">(</span><span class="n">samplet</span><span class="p">,</span> <span class="n">xfm_data</span><span class="p">,</span>
                               <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">[</span><span class="n">samplet</span><span class="p">])</span>

        <span class="n">xfm_ds</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func_description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xfm_ds</span>


    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">train_test_split_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_perc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns two disjoint sets of samplet ids for use in cross-validation.</span>
<span class="sd">        The behaviour of this method differs based on the whether the child class</span>
<span class="sd">        is a ClassificationDataset or RegressionDataset or something else.</span>

<span class="sd">        Offers two ways to specify the sizes: fraction or count.</span>
<span class="sd">        Only one access method can be used at a time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        train_perc : float</span>
<span class="sd">            fraction of samplets to build the training subset.</span>

<span class="sd">        count : int</span>
<span class="sd">            exact count of samplets from each class to build the training subset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        train_set : list</span>
<span class="sd">            List of ids in the training set.</span>
<span class="sd">        test_set : list</span>
<span class="sd">            List of ids in the test set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the fraction is outside open interval (0, 1), or</span>
<span class="sd">            If counts are outside larger than the smallest class, or</span>
<span class="sd">            If unrecongized format is provided for input args, or</span>
<span class="sd">            If the selection results in empty subsets for either train or test sets.</span>

<span class="sd">        &quot;&quot;&quot;</span>


    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">random_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perc</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a random sub-dataset of specified size by percentage</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        perc : float</span>
<span class="sd">            Fraction of samplets to be taken</span>
<span class="sd">            The meaning of this varies based on the child class: for</span>
<span class="sd">            classification- oriented Dataset, this can be perc from each class.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        subdataset : Dataset</span>
<span class="sd">            random sub-dataset of specified size.</span>

<span class="sd">        &quot;&quot;&quot;</span>



    <span class="k">def</span> <span class="nf">get_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a smaller dataset identified by their keys/samplet IDs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset_ids : list</span>
<span class="sd">            List od samplet IDs to extracted from the dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sub-dataset : Dataset</span>
<span class="sd">            sub-dataset containing only requested samplet IDs.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num_existing_keys</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">subset_ids</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">subset_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num_existing_keys</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_subset_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">subset_ids</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_subset_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">,</span> <span class="n">subset_ids</span><span class="p">)</span>
            <span class="n">sub_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">)</span>
            <span class="c1"># Appending the history</span>
            <span class="n">sub_ds</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Subset derived from: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
            <span class="n">sub_ds</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span>
            <span class="n">sub_ds</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>

            <span class="c1"># propagating attributes</span>
            <span class="n">attr_subset</span><span class="p">,</span> <span class="n">attr_dtype_subset</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">attr_subset</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_subset_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span>
                                                         <span class="n">subset_ids</span><span class="p">)</span>
                <span class="n">attr_dtype_subset</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
            <span class="n">sub_ds</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">attr_subset</span>
            <span class="n">sub_ds</span><span class="o">.</span><span class="n">attr_dtype</span> <span class="o">=</span> <span class="n">attr_dtype_subset</span>

            <span class="k">return</span> <span class="n">sub_ds</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;subset of IDs requested do not exist in the dataset!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">get_data_matrix_in_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a numpy array of features, rows in the same order as subset_ids</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subset_ids : list</span>
<span class="sd">            List od samplet IDs to extracted from the dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matrix : ndarray</span>
<span class="sd">            Matrix of features, for each id in subset_ids, in order.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset_ids</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;subset must have atleast one ID - returning empty matrix!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset_ids</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Input set is not ordered, hence can not guarantee order! &#39;</span>
                            <span class="s1">&#39;Must provide a list or tuple.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset_ids</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">subset_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">subset_ids</span><span class="p">,</span> <span class="p">]</span>

        <span class="n">num_existing_keys</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">subset_ids</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">num_existing_keys</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset_ids</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;One or more IDs from subset do not exist in the dataset!&#39;</span><span class="p">)</span>

        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">num_existing_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subset_ids</span><span class="p">):</span>
            <span class="n">matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">matrix</span>


    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="s2">&quot;Boolean test of membership of a samplet in the dataset.&quot;</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">not_found_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;Method like dict.get() which can return specified value if key not found&quot;</span>

        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">not_found_value</span>


    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="s2">&quot;Method to ease data retrieval i.e. turn dataset.data[&#39;id&#39;] into dataset[&#39;id&#39;] &quot;</span>

        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> not found in dataset.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to replace features for existing samplet&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_features</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">!=</span> <span class="n">features</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dimensionality of supplied features (</span><span class="si">{}</span><span class="s1">) &#39;</span>
                                 <span class="s1">&#39;does not match existing samplets (</span><span class="si">{}</span><span class="s1">)&#39;</span>
                                 <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> not found in dataset.&#39;</span>
                           <span class="s1">&#39; Can not replace features of a non-existing samplet.&#39;</span>
                           <span class="s1">&#39; Add it first via .add_samplet()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Iterator over samplets&quot;</span>

        <span class="k">for</span> <span class="n">samplet</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">samplet</span><span class="p">,</span> <span class="n">features</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_subset_from_dict</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">subset</span><span class="p">):</span>
        <span class="c1"># Using OrderedDict helps ensure data are added to data, targets etc</span>
        <span class="c1"># in the same order of samplet IDs</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">samplet_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sample identifiers (strings) forming the basis of Dataset&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Text description (header) that can be set by user.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>


    <span class="nd">@description</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Text description that can be set by user.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">str_val</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;description can not be empty&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">str_val</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;number of features in each samplet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">)</span>


    <span class="nd">@num_features</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">num_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_val</span><span class="p">):</span>
        <span class="s2">&quot;Method that should not exist!&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;num_features property can&#39;t be set, only retrieved!&quot;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the data type of the features in the Dataset&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

    <span class="nd">@dtype</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_val</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s1">&#39;Data type can only be set during initialization!&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_samplets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;number of samplets in the entire dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the pythonic shape of the dataset: num_samplets x num_features.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_features</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span>


    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a concise and useful text summary of the dataset.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt_str</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns variants of str repr to be used in .format() invocations&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluatable repr&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_attr_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Text summary of attributes, samplet- and dataset-wise, in the dataset.&quot;&quot;&quot;</span>

        <span class="c1"># newline appended already if this is not empty</span>
        <span class="n">attr_descr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr_repr</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span> <span class="c1"># atleast one attribute exists!</span>
            <span class="n">attr_counts</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">attr_descr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> samplet attributes: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">),</span>
                                                             <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr_counts</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">attr_descr</span>


    <span class="k">def</span> <span class="nf">_dataset_attr_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Text summary of attributes in the dataset.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span><span class="p">:</span> <span class="c1"># atleast one attribute exists!</span>
            <span class="n">attr_descr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> dataset attributes: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span> \
                         <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span><span class="p">),</span>
                                   <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attr_descr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">attr_descr</span>


    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy constructor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">attr_dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dataset_attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">num_features</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_arff</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arff_path</span><span class="p">,</span> <span class="n">encode_nonnumeric</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads a given dataset saved in Weka&#39;s ARFF format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        arff_path : str</span>
<span class="sd">            Path to a dataset saved in Weka&#39;s ARFF file format.</span>

<span class="sd">        encode_nonnumeric : bool</span>
<span class="sd">            Flag to specify whether to encode non-numeric features (categorical,</span>
<span class="sd">            nominal or string) features to numeric values.</span>
<span class="sd">            Currently used only when importing ARFF files.</span>
<span class="sd">            It is usually better to encode your data at the source,</span>
<span class="sd">            and then import them. Use with caution!</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scipy.io.arff</span> <span class="k">import</span> <span class="n">loadarff</span>
            <span class="n">arff_data</span><span class="p">,</span> <span class="n">arff_meta</span> <span class="o">=</span> <span class="n">loadarff</span><span class="p">(</span><span class="n">arff_path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error loading the ARFF dataset!&#39;</span><span class="p">)</span>

        <span class="n">attr_names</span> <span class="o">=</span> <span class="n">arff_meta</span><span class="o">.</span><span class="n">names</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last column is class</span>
        <span class="n">attr_types</span> <span class="o">=</span> <span class="n">arff_meta</span><span class="o">.</span><span class="n">types</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">encode_nonnumeric</span><span class="p">:</span>
            <span class="c1"># ensure all the attributes are numeric</span>
            <span class="n">uniq_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attr_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;numeric&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniq_types</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Currently only numeric attributes in ARFF are supported!&#39;</span><span class="p">)</span>

            <span class="n">non_numeric</span> <span class="o">=</span> <span class="n">uniq_types</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="s1">&#39;numeric&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_numeric</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Non-numeric features provided (</span><span class="si">{}</span><span class="s1">), &#39;</span>
                                 <span class="s1">&#39;without requesting encoding to numeric. &#39;</span>
                                 <span class="s1">&#39;Try setting encode_nonnumeric=True &#39;</span>
                                 <span class="s1">&#39;or encode features to numeric!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">non_numeric</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s1">&#39;encoding non-numeric features to numeric is not implemented yet! &#39;</span>
                <span class="s1">&#39;Encode features beforing to ARFF.&#39;</span><span class="p">)</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">arff_meta</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># initializing the key containers, before calling self.add_samplet</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arff_data</span><span class="p">)</span>
        <span class="n">num_digits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num_samples</span><span class="p">))</span>
        <span class="n">make_id</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">index</span><span class="p">:</span> <span class="s1">&#39;row{index:0</span><span class="si">{nd}</span><span class="s1">d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">nd</span><span class="o">=</span><span class="n">num_digits</span><span class="p">)</span>
        <span class="n">sample_classes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">arff_data</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]]</span>
        <span class="n">class_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sample_classes</span><span class="p">)</span>
        <span class="n">label_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># encoding class names to targets 1 to n</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_set</span><span class="p">):</span>
            <span class="n">label_dict</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
            <span class="n">samplet</span> <span class="o">=</span> <span class="n">arff_data</span><span class="o">.</span><span class="n">take</span><span class="p">([</span><span class="n">index</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">sample_attrs</span> <span class="o">=</span> <span class="n">samplet</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">sample_class</span> <span class="o">=</span> <span class="n">samplet</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">add_samplet</span><span class="p">(</span><span class="n">samplet_id</span><span class="o">=</span><span class="n">make_id</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>  <span class="c1"># ARFF rows do not have an ID</span>
                                <span class="n">features</span><span class="o">=</span><span class="n">sample_attrs</span><span class="p">,</span>
                                <span class="n">target</span><span class="o">=</span><span class="n">sample_class</span><span class="p">)</span>
            <span class="c1"># not necessary to set feature_names=attr_names for each samplet,</span>
            <span class="c1"># as we do it globally after loop</span>

        <span class="n">dataset</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="n">attr_names</span>

        <span class="k">return</span> <span class="n">dataset</span>


    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to load the serialized dataset from disk.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">df</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="n">_loaded_target_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Unable to read the dataset from file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># checking the mechanics, lengths, common dimensionality etc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>

            <span class="c1"># validating target type</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">_loaded_target_type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unexpected target type </span><span class="si">{}</span><span class="s1">. It must be </span><span class="si">{}</span><span class="s1"> or alike!&#39;</span>
                                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_loaded_target_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span>
             <span class="n">allow_constant_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">allow_constant_features_across_samplets</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to save the dataset to disk.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>
<span class="sd">            File path to save the current dataset to</span>

<span class="sd">        allow_constant_features : bool</span>
<span class="sd">            Flag indicating whether to allow all the values for features for a</span>
<span class="sd">            samplet to be identical (e.g. all zeros). This flag (when False)</span>
<span class="sd">            intends to catch unusual, and likely incorrect, situations when all</span>
<span class="sd">            features for a  given samplet are all zeros or are all some other</span>
<span class="sd">            constant value. In normal, natural, and real-world scenarios,</span>
<span class="sd">            different features will have different values. So when they are 0s or</span>
<span class="sd">            some other constant value, it is indicative of a bug somewhere. When</span>
<span class="sd">            constant values is intended, pass True for this flag.</span>

<span class="sd">        allow_constant_features_across_samplets : bool</span>
<span class="sd">            While the previous flag allow_constant_features looks at one samplet</span>
<span class="sd">            at a time (across features; along rows in feature matrix X: N x p),</span>
<span class="sd">            this flag checks for constant values across all samplets for a given</span>
<span class="sd">            feature (along the columns). When similar values are expected across</span>
<span class="sd">            all samplets, pass True to this flag.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IOError</span>
<span class="sd">            If saving to disk is not successful.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO need a file format that is flexible and efficient to allow the following:</span>
        <span class="c1">#   1) being able to read just meta info without having to load the ENTIRE dataset</span>
        <span class="c1">#       i.e. use case: compatibility check with #subjects, ids and their classes</span>
        <span class="c1">#   2) random access layout: being able to read features for a single subject!</span>


        <span class="c1"># sanity check #1 : per samplet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_constant_features</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_constant_features_in_samplets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

        <span class="c1"># sanity check # 2 : per feature across samplets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_constant_features_across_samplets</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_samplets</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data_matrix</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_and_targets</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_constant_features_across_samplets</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_attr</span><span class="p">),</span>
                            <span class="n">df</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Unable to save the dataset to file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="s2">&quot;checking the mechanics, lengths, common dimensionality etc&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;data must be a dict! &#39;</span>
                            <span class="s1">&#39;keys: samplet ID or any unique identifier&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;targets must be a dict! &#39;</span>
                            <span class="s1">&#39;keys: samplet ID or any unique identifier&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Lengths of data, targets and classes do not match!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">targets</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data and targets dict&#39;s must have the same keys!&quot;</span><span class="p">)</span>

        <span class="n">num_features_in_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">samplet</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">samplet</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">num_features_in_elements</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Different samplets have different number of features &#39;</span>
                             <span class="s1">&#39;- invalid! Different dimensionalities detected: </span><span class="si">{}</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_features_in_elements</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_for_constant_features_in_samplets</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper to catch constant values in the samplets.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">samplet</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">uniq_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
            <span class="c1"># when there is only one unique value, among n features</span>
            <span class="k">if</span> <span class="n">uniq_values</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConstantValuesException</span><span class="p">(</span>
                    <span class="s1">&#39;Constant values (</span><span class="si">{}</span><span class="s1">) detected for </span><span class="si">{}</span><span class="s1"> &#39;</span>
                    <span class="s1">&#39;- double check the process, &#39;</span>
                    <span class="s1">&#39;or disable this check!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uniq_values</span><span class="p">,</span> <span class="n">samplet</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">_check_for_constant_features_across_samplets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_matrix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sanity check to identify identical values for all samplets for a given</span>
<span class="sd">        feature</span>
<span class="sd">         &quot;&quot;&quot;</span>

        <span class="c1"># notice the transpose, which makes it a column</span>
        <span class="k">for</span> <span class="n">col_ix</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
            <span class="n">uniq_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uniq_values</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConstantValuesException</span><span class="p">(</span>
                    <span class="s1">&#39;Constant values (</span><span class="si">{}</span><span class="s1">) detected for feature </span><span class="si">{}</span><span class="s1"> (index </span><span class="si">{}</span><span class="s1">) - &#39;</span>
                    <span class="s1">&#39;double check the process, &#39;</span>
                    <span class="s1">&#39;or disable this check (strongly discouraged)!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">uniq_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">[</span><span class="n">col_ix</span><span class="p">],</span> <span class="n">col_ix</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to extend the dataset vertically (add samplets from  anotehr dataset).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : Dataset</span>
<span class="sd">            second dataset to be combined with the current</span>
<span class="sd">            (different samplets, but same dimensionality)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            if input is not an Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Incorrect type of dataset provided!&#39;</span><span class="p">)</span>
        <span class="c1"># assert self.__dtype==other.dtype, TypeError(&#39;Incorrect data type of features!&#39;)</span>
        <span class="k">for</span> <span class="n">samplet</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_samplet</span><span class="p">(</span><span class="n">samplet</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">samplet</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">samplet</span><span class="p">])</span>

        <span class="c1"># TODO need a mechanism add one feature at a time, and</span>
        <span class="c1">#   consequently update feature names for any subset of features</span>


    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s2">&quot;Method to combine to MLDatasets, samplet-wise or feature-wise.&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Incorrect type of dataset provided!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Identical keys found. &#39;</span>
                  <span class="s1">&#39;Trying to horizontally concatenate features for each samplet.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">num_features</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No features to concatenate.&#39;</span><span class="p">)</span>
            <span class="c1"># making an empty dataset</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
            <span class="c1"># populating it with the concatenated feature set</span>
            <span class="k">for</span> <span class="n">samplet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
                <span class="n">comb_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">samplet</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">samplet</span><span class="p">]])</span>
                <span class="n">combined</span><span class="o">.</span><span class="n">add_samplet</span><span class="p">(</span><span class="n">samplet</span><span class="p">,</span> <span class="n">comb_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">[</span><span class="n">samplet</span><span class="p">])</span>

            <span class="n">comb_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">feature_names</span><span class="p">])</span>
            <span class="n">combined</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">comb_names</span>

            <span class="k">return</span> <span class="n">combined</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="n">other</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">num_features</span><span class="p">:</span>
            <span class="c1"># making a copy of self first</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">in_dataset</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># adding the new dataset</span>
            <span class="n">combined</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">combined</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s1">&#39;Two datasets could not be combined.&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removing one dataset from another.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Incorrect type of dataset provided!&#39;</span><span class="p">)</span>

        <span class="n">num_existing_keys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">num_existing_keys</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;None of the samplet ids to be removed found in this dataset &#39;</span>
                          <span class="s1">&#39;- nothing to do.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_existing_keys</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Requested removal of all the samplets - &#39;</span>
                          <span class="s1">&#39;output dataset would be empty.&#39;</span><span class="p">)</span>

        <span class="n">removed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">samplet</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
            <span class="n">removed</span><span class="o">.</span><span class="n">del_samplet</span><span class="p">(</span><span class="n">samplet</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">removed</span>


    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Augmented assignment for add.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Augmented assignment for samplet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Equality of two datasets in samplets and their values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;differing samplet ids.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplet_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;differing data for the samplet ids.&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>




</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pradeep Reddy Raamana

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>